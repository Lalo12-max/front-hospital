<div class="auth-form-container">
  <p-toast></p-toast>
  <p-card>
    <div class="text-center">
      <h1>Registro</h1>
      <p>Crear nueva cuenta en el sistema</p>
    </div>
    
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <div class="p-field">
        <label for="nombre">Nombre Completo</label>
        <input 
          pInputText 
          id="nombre" 
          formControlName="nombre" 
          placeholder="Ingresa tu nombre completo"
          [class.ng-invalid]="registerForm.get('nombre')?.invalid && registerForm.get('nombre')?.touched"
        />
        <small 
          class="p-error" 
          *ngIf="registerForm.get('nombre')?.invalid && registerForm.get('nombre')?.touched"
        >
          El nombre es requerido
        </small>
      </div>
      
      <div class="p-field">
        <label for="email">Correo Electr칩nico</label>
        <input 
          pInputText 
          id="email" 
          formControlName="email" 
          placeholder="ejemplo@hospital.com"
          [class.ng-invalid]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
        />
        <small 
          class="p-error" 
          *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
        >
          El correo electr칩nico es requerido y debe ser v치lido
        </small>
      </div>
      
      <div class="p-field">
        <label for="password">Contrase침a</label>
        <p-password 
          formControlName="password" 
          placeholder="M칤nimo 12 caracteres con s칤mbolos y n칰meros"
          [toggleMask]="true"
          [feedback]="false"
          (input)="onPasswordChange($event)"
        ></p-password>
        
        <div class="password-requirements" *ngIf="registerForm.get('password')?.value">
          <div class="requirement-item" [class.valid]="passwordValidation.length">
            <i class="pi" [class.pi-check]="passwordValidation.length" [class.pi-times]="!passwordValidation.length"></i>
            M칤nimo 12 caracteres
          </div>
          <div class="requirement-item" [class.valid]="passwordValidation.hasNumber">
            <i class="pi" [class.pi-check]="passwordValidation.hasNumber" [class.pi-times]="!passwordValidation.hasNumber"></i>
            Al menos un n칰mero
          </div>
          <div class="requirement-item" [class.valid]="passwordValidation.hasLower">
            <i class="pi" [class.pi-check]="passwordValidation.hasLower" [class.pi-times]="!passwordValidation.hasLower"></i>
            Al menos una letra min칰scula
          </div>
          <div class="requirement-item" [class.valid]="passwordValidation.hasUpper">
            <i class="pi" [class.pi-check]="passwordValidation.hasUpper" [class.pi-times]="!passwordValidation.hasUpper"></i>
            Al menos una letra may칰scula
          </div>
          <div class="requirement-item" [class.valid]="passwordValidation.hasSymbol">
            <i class="pi" [class.pi-check]="passwordValidation.hasSymbol" [class.pi-times]="!passwordValidation.hasSymbol"></i>
            Al menos un s칤mbolo (!&#64;#$%^&*)
          </div>
        </div>
        
        <small 
          class="p-error" 
          *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
        >
          La contrase침a debe cumplir con todos los requisitos de seguridad
        </small>
      </div>
      
      <div class="p-field">
        <label for="confirmPassword">Confirmar Contrase침a</label>
        <p-password 
          formControlName="confirmPassword" 
          placeholder="Repite tu contrase침a"
          [toggleMask]="true"
          [feedback]="false"
        ></p-password>
        <small 
          class="p-error" 
          *ngIf="registerForm.hasError('passwordMismatch') && registerForm.get('confirmPassword')?.touched"
        >
          Las contrase침as no coinciden
        </small>
      </div>
      
      <div class="p-field">
        <p-button 
          label="Registrarse" 
          type="submit" 
          [disabled]="registerForm.invalid || !isPasswordValid"
          [loading]="isLoading"
        ></p-button>
      </div>
    </form>
    
    <div class="text-center mt-3">
      <p>쯏a tienes cuenta? <a routerLink="/login">Inicia sesi칩n aqu칤</a></p>
    </div>
  </p-card>

  <p-dialog 
    header="Configurar Autenticaci칩n de Dos Factores (MFA)" 
    [(visible)]="showMFADialog" 
    [modal]="true" 
    [closable]="false"
    [style]="{width: '500px'}"
  >
    <div class="mfa-dialog">
      <p>Para completar tu registro, configura la autenticaci칩n de dos factores:</p>

      <!-- Agregar secci칩n del c칩digo QR -->
      <div class="qr-code-container" *ngIf="qrCodeDataUrl">
        <h4>游님 Escanea este c칩digo QR:</h4>
        <img [src]="qrCodeDataUrl" alt="C칩digo QR para MFA" />
        <p><small>Usa Google Authenticator, Authy o cualquier app de autenticaci칩n compatible</small></p>
      </div>

      <h4>Ingresa manualmente esta clave</h4>
      <div class="secret-key">
        {{ secretKey }}
        <p-button 
          icon="pi pi-copy" 
          (click)="copiarClaveSecreta()" 
          [text]="true" 
          size="small"
          pTooltip="Copiar clave secreta"
        ></p-button>
      </div>
      
      <p-button 
        label="Continuar al Login" 
        (click)="continuarAlLogin()" 
        class="p-button-success"
      ></p-button>
    </div>
  </p-dialog>
</div>